<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿ - åˆ†å±‚æ¶æ„å·¥ä½œæµç®¡ç†å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .header .version {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .global-controls {
            background: #f8f9fa;
            padding: 25px 40px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-info { background: linear-gradient(135deg, #17a2b8, #138496); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #6c757d, #545b62); color: white; }

        .architecture-container {
            padding: 40px;
            background: #f5f7fa;
        }

        .layer {
            margin-bottom: 50px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .layer:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .layer-header {
            padding: 30px 40px;
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
            text-align: center;
            position: relative;
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .layer-1 .layer-header { 
            background: linear-gradient(135deg, #4CAF50, #45a049, #2E7D32);
            border-left: 6px solid #2E7D32;
        }
        .layer-2 .layer-header { 
            background: linear-gradient(135deg, #2196F3, #1976D2, #0D47A1);
            border-left: 6px solid #0D47A1;
        }
        .layer-3 .layer-header { 
            background: linear-gradient(135deg, #FF9800, #F57C00, #E65100);
            border-left: 6px solid #E65100;
        }
        .layer-4 .layer-header { 
            background: linear-gradient(135deg, #9C27B0, #7B1FA2, #4A148C);
            border-left: 6px solid #4A148C;
        }
        .layer-5 .layer-header { 
            background: linear-gradient(135deg, #F44336, #D32F2F, #B71C1C);
            border-left: 6px solid #B71C1C;
        }

        .layer-stats {
            position: absolute;
            top: 50%;
            right: 40px;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.25);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .layer-content {
            padding: 40px;
        }

        .layer-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .layer-controls .btn {
            font-size: 0.9rem;
            padding: 10px 20px;
        }

        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .workflow-subgroup {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #dee2e6;
            position: relative;
            overflow: hidden;
        }

        .workflow-subgroup::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2196F3, #21CBF3, #2196F3);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: -200% 0; }
            50% { background-position: 200% 0; }
        }

        .subgroup-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #495057;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #dee2e6;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subgroup-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .subgroup-controls .btn {
            font-size: 0.8rem;
            padding: 8px 16px;
        }

        .subgroup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .workflow-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .workflow-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #007bff, transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .workflow-card:hover::before {
            transform: translateX(100%);
        }

        .workflow-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            border-color: #007bff;
        }

        .card-header {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-bottom: 2px solid #e9ecef;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 700;
            color: #495057;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-subtitle {
            font-size: 0.85rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .card-body {
            padding: 20px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .status-configured {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-unconfigured {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-running {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border: 1px solid #ffeaa7;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .workflow-details {
            margin-bottom: 15px;
            font-size: 0.8rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .detail-label {
            color: #6c757d;
            font-weight: 600;
        }

        .detail-value {
            color: #495057;
            font-weight: 500;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }

        .webhook-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.85rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .webhook-input:focus {
            outline: none;
            border-color: #007bff;
            background: white;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .card-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .card-actions .btn {
            flex: 1;
            font-size: 0.8rem;
            padding: 8px 12px;
            min-width: 80px;
            justify-content: center;
        }

        .dependency-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }

        .flow-arrow {
            font-size: 3rem;
            color: #6c757d;
            animation: bounce 2s infinite;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            max-width: 350px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success { background: linear-gradient(135deg, #28a745, #20c997); }
        .toast-error { background: linear-gradient(135deg, #dc3545, #fd7e14); }
        .toast-info { background: linear-gradient(135deg, #17a2b8, #6f42c1); }

        @media (max-width: 768px) {
            .workflow-grid, .subgroup-grid {
                grid-template-columns: 1fr;
            }
            
            .global-controls, .layer-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
            
            .layer-header {
                padding: 20px;
                font-size: 1.2rem;
            }
            
            .layer-content {
                padding: 20px;
            }
        }

        .execution-mode {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .mode-parallel {
            background: #e3f2fd;
            color: #1565c0;
        }

        .mode-serial {
            background: #fff3e0;
            color: #ef6c00;
        }

        .mode-mixed {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .mode-independent {
            background: #e8f5e8;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <div class="version">v2.1 æ¶æ„ç‰ˆ</div>
            <h1>ğŸ¯ ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿ</h1>
            <p>åˆ†å±‚åˆ†è¡¨çš„ä¸“ä¸šåŒ–å¤„ç†ç®¡é“ - å®Œæ•´æ¶æ„å·¥ä½œæµç®¡ç†å™¨</p>
        </div>

        <!-- å…¨å±€æ§åˆ¶åŒº -->
        <div class="global-controls">
            <button class="btn btn-success" onclick="runLayerSequentially()">
                ğŸš€ æŒ‰å±‚çº§é¡ºåºæ‰§è¡Œ
            </button>
            <button class="btn btn-primary" onclick="runDataCollectionLayer()">
                ğŸ“¥ å¯åŠ¨æ•°æ®é‡‡é›†å±‚
            </button>
            <button class="btn btn-warning" onclick="pauseAllWorkflows()">
                â¸ï¸ æš‚åœæ‰€æœ‰å·¥ä½œæµ
            </button>
            <button class="btn btn-info" onclick="refreshAllStatus()">
                ğŸ”„ åˆ·æ–°æ‰€æœ‰çŠ¶æ€
            </button>
            <button class="btn btn-secondary" onclick="exportAllConfigs()">
                ğŸ“¤ å¯¼å‡ºé…ç½®
            </button>
            <a href="https://us2.make.com/972028/scenarios" target="_blank" class="btn btn-primary">
                ğŸ”— Makeæ§åˆ¶å°
            </a>
        </div>

        <!-- æ¶æ„è§†å›¾ -->
        <div class="architecture-container">
            <!-- ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†å±‚ -->
            <div class="layer layer-1">
                <div class="layer-header">
                    ğŸ“¥ ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†å±‚
                    <span class="execution-mode mode-parallel">å¹¶è¡Œæ‰§è¡Œ</span>
                    <div class="layer-stats" id="layer1-stats">0/6 å·²é…ç½®</div>
                </div>
                <div class="layer-content">
                    <div class="layer-controls">
                        <button class="btn btn-success" onclick="runLayer(1)">â–¶ï¸ å¯åŠ¨æœ¬å±‚</button>
                        <button class="btn btn-warning" onclick="pauseLayer(1)">â¸ï¸ æš‚åœæœ¬å±‚</button>
                        <button class="btn btn-info" onclick="checkLayerStatus(1)">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
                    </div>
                    <div class="workflow-grid" id="layer1-grid">
                        <!-- ç¬¬ä¸€å±‚å·¥ä½œæµå°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ä¾èµ–æµå‘ç®­å¤´ -->
            <div class="dependency-flow">
                <div class="flow-arrow">â¬‡ï¸</div>
            </div>

            <!-- ç¬¬äºŒå±‚ï¼šä¿¡å·è¯†åˆ«å±‚ -->
            <div class="layer layer-2">
                <div class="layer-header">
                    ğŸ¯ ç¬¬äºŒå±‚ï¼šä¿¡å·è¯†åˆ«å±‚
                    <span class="execution-mode mode-mixed">æ··åˆæ‰§è¡Œ</span>
                    <div class="layer-stats" id="layer2-stats">0/7 å·²é…ç½®</div>
                </div>
                <div class="layer-content">
                    <div class="layer-controls">
                        <button class="btn btn-success" onclick="runLayer(2)">â–¶ï¸ å¯åŠ¨æœ¬å±‚</button>
                        <button class="btn btn-warning" onclick="pauseLayer(2)">â¸ï¸ æš‚åœæœ¬å±‚</button>
                        <button class="btn btn-info" onclick="checkLayerStatus(2)">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
                    </div>
                    
                    <!-- WF7å­å·¥ä½œæµç»„ -->
                    <div class="workflow-subgroup">
                        <div class="subgroup-title">
                            ğŸ” WF7: æŠ€æœ¯ä¿¡å·è¯†åˆ«æµç»„ - åˆ†è¡¨å¤„ç†
                            <span class="execution-mode mode-parallel">å¹¶è¡Œæ‰§è¡Œ</span>
                        </div>
                        <div class="subgroup-controls">
                            <button class="btn btn-success" onclick="runWF7Subgroup()">â–¶ï¸ è¿è¡ŒWF7å­ç»„</button>
                            <button class="btn btn-info" onclick="batchConfigureWF7()">âš™ï¸ æ‰¹é‡é…ç½®WF7</button>
                            <button class="btn btn-secondary" onclick="checkWF7Status()">ğŸ“Š WF7çŠ¶æ€</button>
                        </div>
                        <div class="subgroup-grid" id="wf7-subgroup">
                            <!-- WF7-1åˆ°WF7-6å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- WF8ç‹¬ç«‹å·¥ä½œæµ -->
                    <div class="workflow-grid" id="layer2-grid">
                        <!-- WF8å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ä¾èµ–æµå‘ç®­å¤´ -->
            <div class="dependency-flow">
                <div class="flow-arrow">â¬‡ï¸</div>
            </div>

            <!-- ç¬¬ä¸‰å±‚ï¼šæ·±åº¦åˆ†æå±‚ -->
            <div class="layer layer-3">
                <div class="layer-header">
                    ğŸ“Š ç¬¬ä¸‰å±‚ï¼šæ·±åº¦åˆ†æå±‚
                    <span class="execution-mode mode-parallel">å¹¶è¡Œæ‰§è¡Œ</span>
                    <div class="layer-stats" id="layer3-stats">0/3 å·²é…ç½®</div>
                </div>
                <div class="layer-content">
                    <div class="layer-controls">
                        <button class="btn btn-success" onclick="runLayer(3)">â–¶ï¸ å¯åŠ¨æœ¬å±‚</button>
                        <button class="btn btn-warning" onclick="pauseLayer(3)">â¸ï¸ æš‚åœæœ¬å±‚</button>
                        <button class="btn btn-info" onclick="checkLayerStatus(3)">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
                    </div>
                    <div class="workflow-grid" id="layer3-grid">
                        <!-- ç¬¬ä¸‰å±‚å·¥ä½œæµå°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ä¾èµ–æµå‘ç®­å¤´ -->
            <div class="dependency-flow">
                <div class="flow-arrow">â¬‡ï¸</div>
            </div>

            <!-- ç¬¬å››å±‚ï¼šå†³ç­–æ”¯æ’‘å±‚ -->
            <div class="layer layer-4">
                <div class="layer-header">
                    ğŸ¯ ç¬¬å››å±‚ï¼šå†³ç­–æ”¯æ’‘å±‚
                    <span class="execution-mode mode-serial">ä¸²è¡Œæ‰§è¡Œ</span>
                    <div class="layer-stats" id="layer4-stats">0/2 å·²é…ç½®</div>
                </div>
                <div class="layer-content">
                    <div class="layer-controls">
                        <button class="btn btn-success" onclick="runLayer(4)">â–¶ï¸ å¯åŠ¨æœ¬å±‚</button>
                        <button class="btn btn-warning" onclick="pauseLayer(4)">â¸ï¸ æš‚åœæœ¬å±‚</button>
                        <button class="btn btn-info" onclick="checkLayerStatus(4)">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
                    </div>
                    <div class="workflow-grid" id="layer4-grid">
                        <!-- ç¬¬å››å±‚å·¥ä½œæµå°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- ä¾èµ–æµå‘ç®­å¤´ -->
            <div class="dependency-flow">
                <div class="flow-arrow">â¬‡ï¸</div>
            </div>

            <!-- ç¬¬äº”å±‚ï¼šç³»ç»Ÿç»´æŠ¤å±‚ -->
            <div class="layer layer-5">
                <div class="layer-header">
                    ğŸ”§ ç¬¬äº”å±‚ï¼šç³»ç»Ÿç»´æŠ¤å±‚
                    <span class="execution-mode mode-independent">ç‹¬ç«‹è¿è¡Œ</span>
                    <div class="layer-stats" id="layer5-stats">0/2 å·²é…ç½®</div>
                </div>
                <div class="layer-content">
                    <div class="layer-controls">
                        <button class="btn btn-success" onclick="runLayer(5)">â–¶ï¸ å¯åŠ¨æœ¬å±‚</button>
                        <button class="btn btn-warning" onclick="pauseLayer(5)">â¸ï¸ æš‚åœæœ¬å±‚</button>
                        <button class="btn btn-info" onclick="checkLayerStatus(5)">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
                    </div>
                    <div class="workflow-grid" id="layer5-grid">
                        <!-- ç¬¬äº”å±‚å·¥ä½œæµå°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æŒ‰çœŸå®æ¶æ„å®šä¹‰çš„å®Œæ•´å·¥ä½œæµé…ç½®
        let workflows = JSON.parse(localStorage.getItem('workflows')) || {
            // ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†å±‚ (å¹¶è¡Œæ‰§è¡Œ)
            'WF1': {
                id: 'WF1',
                name: 'å­¦æœ¯è®ºæ–‡æ–‡çŒ®æµ',
                description: 'ç›‘æ§arXivã€Google Scholarã€IEEEç­‰å­¦æœ¯è®ºæ–‡æ•°æ®æº',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_Academic_Papers'
            },
            'WF2': {
                id: 'WF2',
                name: 'ä¸“åˆ©ç”³è¯·è¿½è¸ªæµ',
                description: 'è¿½è¸ªUSPTOã€EPOã€Google Patentsç­‰ä¸“åˆ©ç”³è¯·',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_Patent_Data'
            },
            'WF3': {
                id: 'WF3',
                name: 'å¼€æºé¡¹ç›®ç›‘æµ‹æµ',
                description: 'ç›‘æµ‹GitHubã€GitLabç­‰å¼€æºé¡¹ç›®åŠ¨æ€',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_OpenSource_Data'
            },
            'WF4': {
                id: 'WF4',
                name: 'äº§ä¸šæ–°é—»ç›‘æ§æµ',
                description: 'è·å–TechCrunchã€MIT Tech Reviewç­‰äº§ä¸šæ–°é—»',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_Tech_News'
            },
            'WF5': {
                id: 'WF5',
                name: 'äº§ä¸šåŠ¨æ€æ•è·æµ',
                description: 'æ•è·ä¼šè®®ã€SECæ–‡ä»¶ã€å…¬å¸å…¬å‘Šç­‰äº§ä¸šåŠ¨æ€',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_Industry_Dynamics'
            },
            'WF6': {
                id: 'WF6',
                name: 'ç«äº‰å¯¹æ‰‹æ”¶é›†æµ',
                description: 'æ”¶é›†ç«äº‰å¯¹æ‰‹ç›¸å…³æƒ…æŠ¥å’Œå¸‚åœºåŠ¨æ€',
                layer: 1,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                outputTable: 'Raw_Competitor_Intelligence'
            },

            // ç¬¬äºŒå±‚ï¼šä¿¡å·è¯†åˆ«å±‚ (ä¸²è¡Œæ‰§è¡Œ)
            // WF7å­å·¥ä½œæµç»„ - åˆ†è¡¨ä¿¡å·è¯†åˆ«
            'WF7-1': {
                id: 'WF7-1',
                name: 'å­¦æœ¯è®ºæ–‡ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_Academic_Papersè¡¨è¯†åˆ«æŠ€æœ¯çªç ´ä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF1'],
                inputTable: 'Raw_Academic_Papers',
                outputTable: 'Tech_Intelligence_Master'
            },
            'WF7-2': {
                id: 'WF7-2',
                name: 'ä¸“åˆ©æ•°æ®ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_Patent_Dataè¡¨è¯†åˆ«ä¸“åˆ©çªç ´ä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF2'],
                inputTable: 'Raw_Patent_Data',
                outputTable: 'Tech_Intelligence_Master'
            },
            'WF7-3': {
                id: 'WF7-3',
                name: 'å¼€æºé¡¹ç›®ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_OpenSource_Dataè¡¨è¯†åˆ«é¡¹ç›®åˆ›æ–°ä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF3'],
                inputTable: 'Raw_OpenSource_Data',
                outputTable: 'Tech_Intelligence_Master'
            },
            'WF7-4': {
                id: 'WF7-4',
                name: 'æŠ€æœ¯æ–°é—»ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_Tech_Newsè¡¨è¯†åˆ«æ–°é—»ä»·å€¼ä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF4'],
                inputTable: 'Raw_Tech_News',
                outputTable: 'Tech_Intelligence_Master'
            },
            'WF7-5': {
                id: 'WF7-5',
                name: 'äº§ä¸šåŠ¨æ€ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_Industry_Dynamicsè¡¨è¯†åˆ«äº§ä¸šå½±å“ä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF5'],
                inputTable: 'Raw_Industry_Dynamics',
                outputTable: 'Tech_Intelligence_Master'
            },
            'WF7-6': {
                id: 'WF7-6',
                name: 'ç«äº‰æƒ…æŠ¥ä¿¡å·è¯†åˆ«',
                description: 'ä»Raw_Competitor_Intelligenceè¡¨è¯†åˆ«å¨èƒä¿¡å·',
                layer: 2,
                subgroup: 'WF7',
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF6'],
                inputTable: 'Raw_Competitor_Intelligence',
                                outputTable: 'Tech_Intelligence_Master'
            },

            // WF8 - è¯æ®éªŒè¯å¤„ç†æµ
            'WF8': {
                id: 'WF8',
                name: 'è¯æ®éªŒè¯å¤„ç†æµ',
                description: 'éªŒè¯Tech_Intelligence_Masterä¸­æƒ…æŠ¥çš„è¯æ®è´¨é‡',
                layer: 2,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF7-1', 'WF7-2', 'WF7-3', 'WF7-4', 'WF7-5', 'WF7-6'],
                inputTable: 'Tech_Intelligence_Master',
                outputTable: 'Evidence_Validation_Matrix'
            },

            // ç¬¬ä¸‰å±‚ï¼šæ·±åº¦åˆ†æå±‚ (å¹¶è¡Œæ‰§è¡Œ)
            'WF9': {
                id: 'WF9',
                name: 'å•†ä¸šä»·å€¼åˆ†ææµ',
                description: 'åˆ†ææŠ€æœ¯çš„å•†ä¸šä»·å€¼ã€å¸‚åœºæ½œåŠ›å’ŒæŠ•èµ„å›æŠ¥',
                layer: 3,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF8'],
                inputTable: 'Tech_Intelligence_Master (verified)',
                outputTable: 'Commercial_Value_Quantification'
            },
            'WF10': {
                id: 'WF10',
                name: 'ç«äº‰æƒ…æŠ¥åˆ†ææµ',
                description: 'åˆ†æç«äº‰æ€åŠ¿ã€å¨èƒç­‰çº§å’Œå¸‚åœºåœ°ä½',
                layer: 3,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF8'],
                inputTable: 'Tech_Intelligence_Master (verified)',
                outputTable: 'Competitive_Intelligence_Monitor'
            },
            'WF11': {
                id: 'WF11',
                name: 'æŠ€æœ¯æ·±åº¦åˆ†ææµ',
                description: 'æ·±åº¦åˆ†ææŠ€æœ¯å¯è¡Œæ€§ã€æˆç†Ÿåº¦å’Œå®æ–½è·¯å¾„',
                layer: 3,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF8'],
                inputTable: 'Tech_Intelligence_Master (verified)',
                outputTable: 'Technical_Deep_Analysis'
            },

            // ç¬¬å››å±‚ï¼šå†³ç­–æ”¯æ’‘å±‚ (ä¸²è¡Œæ‰§è¡Œ)
            'WF12': {
                id: 'WF12',
                name: 'æƒ…æŠ¥æ•´åˆå†³ç­–æµ',
                description: 'æ•´åˆæ‰€æœ‰åˆ†æç»“æœï¼Œç”Ÿæˆç»¼åˆå†³ç­–å»ºè®®',
                layer: 4,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF9', 'WF10', 'WF11'],
                inputTable: 'ä¸‰ç»´åˆ†æç»“æœæ±‡èš',
                outputTable: 'Action_Recommendations'
            },
            'WF13': {
                id: 'WF13',
                name: 'æŠ¥å‘Šç”Ÿæˆè¾“å‡ºæµ',
                description: 'ç”Ÿæˆæƒ…æŠ¥æŠ¥å‘Šå¹¶åˆ†å‘åˆ°å„ä¸ªæ¸ é“',
                layer: 4,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: ['WF12'],
                inputTable: 'Action_Recommendations',
                outputTable: 'å¤šæ¸ é“è¾“å‡º'
            },

            // ç¬¬äº”å±‚ï¼šç³»ç»Ÿç»´æŠ¤å±‚ (ç‹¬ç«‹è¿è¡Œ)
            'WF14': {
                id: 'WF14',
                name: 'æ•°æ®è´¨é‡ç›‘æ§æµ',
                description: 'ç›‘æ§æ•°æ®è´¨é‡ã€å®Œæ•´æ€§å’Œä¸€è‡´æ€§',
                layer: 5,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                inputTable: 'å…¨ç³»ç»Ÿæ•°æ®',
                outputTable: 'Data_Quality_Reports'
            },
            'WF15': {
                id: 'WF15',
                name: 'ç³»ç»Ÿå¥åº·æ£€æŸ¥æµ',
                description: 'æ£€æŸ¥ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡',
                layer: 5,
                webhookUrl: '',
                status: 'unconfigured',
                lastRun: null,
                dependencies: [],
                inputTable: 'ç³»ç»Ÿè¿è¡Œæ—¥å¿—',
                outputTable: 'System_Health_Reports'
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            renderAllLayers();
            updateAllLayerStats();
        }

        // æ¸²æŸ“æ‰€æœ‰å±‚çº§
        function renderAllLayers() {
            renderLayer(1); // æ•°æ®é‡‡é›†å±‚
            renderLayer2WithSubgroups(); // ä¿¡å·è¯†åˆ«å±‚ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰
            renderLayer(3); // æ·±åº¦åˆ†æå±‚
            renderLayer(4); // å†³ç­–æ”¯æ’‘å±‚
            renderLayer(5); // ç³»ç»Ÿç»´æŠ¤å±‚
        }

        // æ¸²æŸ“ç¬¬äºŒå±‚ï¼ˆåŒ…å«WF7å­ç»„ï¼‰
        function renderLayer2WithSubgroups() {
            // æ¸²æŸ“WF7å­å·¥ä½œæµç»„
            const wf7Grid = document.getElementById('wf7-subgroup');
            wf7Grid.innerHTML = '';

            const wf7Workflows = Object.values(workflows).filter(wf => wf.subgroup === 'WF7');
            wf7Workflows.forEach(workflow => {
                const card = createWorkflowCard(workflow);
                wf7Grid.appendChild(card);
            });

            // æ¸²æŸ“WF8
            const layer2Grid = document.getElementById('layer2-grid');
            layer2Grid.innerHTML = '';

            const wf8 = workflows['WF8'];
            if (wf8) {
                const card = createWorkflowCard(wf8);
                layer2Grid.appendChild(card);
            }
        }

        // æ¸²æŸ“å•ä¸ªå±‚çº§
        function renderLayer(layerNumber) {
            if (layerNumber === 2) {
                renderLayer2WithSubgroups();
                return;
            }

            const grid = document.getElementById(`layer${layerNumber}-grid`);
            if (!grid) return;

            grid.innerHTML = '';

            const layerWorkflows = Object.values(workflows).filter(wf => 
                wf.layer === layerNumber && !wf.subgroup
            );

            layerWorkflows.forEach(workflow => {
                const card = createWorkflowCard(workflow);
                grid.appendChild(card);
            });
        }

        // åˆ›å»ºå·¥ä½œæµå¡ç‰‡
        function createWorkflowCard(workflow) {
            const card = document.createElement('div');
            card.className = 'workflow-card';
            card.id = `card-${workflow.id}`;

            const isConfigured = workflow.webhookUrl ? 'configured' : 'unconfigured';
            const statusText = workflow.webhookUrl ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®';
            const statusClass = workflow.status === 'running' ? 'running' : isConfigured;

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">
                        <span style="color: #007bff;">${workflow.id}</span>
                        ${workflow.name}
                    </div>
                    <div class="card-subtitle">${workflow.description}</div>
                </div>
                <div class="card-body">
                    <div class="status-indicator status-${statusClass}">
                        ${statusText}
                    </div>
                    
                    <div class="workflow-details">
                        ${workflow.dependencies.length > 0 ? `
                        <div class="detail-row">
                            <span class="detail-label">ä¾èµ–å…³ç³»:</span>
                            <span class="detail-value">${workflow.dependencies.join(', ')}</span>
                        </div>
                        ` : ''}
                        
                        ${workflow.inputTable ? `
                        <div class="detail-row">
                            <span class="detail-label">è¾“å…¥è¡¨:</span>
                            <span class="detail-value">${workflow.inputTable}</span>
                        </div>
                        ` : ''}
                        
                        ${workflow.outputTable ? `
                        <div class="detail-row">
                            <span class="detail-label">è¾“å‡ºè¡¨:</span>
                            <span class="detail-value">${workflow.outputTable}</span>
                        </div>
                        ` : ''}
                        
                        <div class="detail-row">
                            <span class="detail-label">æœ€åè¿è¡Œ:</span>
                            <span class="detail-value">${workflow.lastRun || 'æœªè¿è¡Œ'}</span>
                        </div>
                    </div>
                    
                    <input type="url" class="webhook-input" 
                           placeholder="è¾“å…¥Make.comçš„Webhook URL" 
                           value="${workflow.webhookUrl || ''}"
                           onchange="updateWebhookUrl('${workflow.id}', this.value)">

                    <div class="card-actions">
                        <button class="btn btn-success" onclick="triggerWorkflow('${workflow.id}')" 
                                ${!workflow.webhookUrl ? 'disabled title="è¯·å…ˆé…ç½®Webhook"' : ''}>
                            â–¶ï¸ è¿è¡Œ
                        </button>
                        <button class="btn btn-info" onclick="testWebhook('${workflow.id}')" 
                                ${!workflow.webhookUrl ? 'disabled' : ''}>
                            ğŸ§ª æµ‹è¯•
                        </button>
                        <a href="https://us2.make.com/972028/scenarios" target="_blank" class="btn btn-secondary">
                            ğŸ”— Make
                        </a>
                    </div>
                </div>
            `;

            return card;
        }

        // æ›´æ–°Webhook URL
        function updateWebhookUrl(workflowId, url) {
            workflows[workflowId].webhookUrl = url.trim();
            workflows[workflowId].status = url.trim() ? 'configured' : 'unconfigured';
            saveWorkflows();
            
            // é‡æ–°æ¸²æŸ“å¯¹åº”å±‚çº§
            const workflow = workflows[workflowId];
            if (workflow.layer === 2) {
                renderLayer2WithSubgroups();
            } else {
                renderLayer(workflow.layer);
            }
            updateLayerStats(workflow.layer);
            
            showToast(`${workflowId} Webhook URLå·²æ›´æ–°`, 'info');
        }

        // è§¦å‘å•ä¸ªå·¥ä½œæµ
        async function triggerWorkflow(workflowId) {
            const workflow = workflows[workflowId];
            if (!workflow.webhookUrl) {
                showToast('è¯·å…ˆé…ç½®Webhook URL', 'error');
                return;
            }

            // æ£€æŸ¥ä¾èµ–å…³ç³»
            if (workflow.dependencies.length > 0) {
                const unmetDependencies = workflow.dependencies.filter(depId => {
                    const dep = workflows[depId];
                    return !dep || dep.status !== 'completed';
                });

                if (unmetDependencies.length > 0) {
                    const proceed = confirm(`ä¾èµ–é¡¹ ${unmetDependencies.join(', ')} å¯èƒ½æœªå®Œæˆã€‚ç¡®å®šè¦ç»§ç»­è¿è¡Œå—ï¼Ÿ`);
                    if (!proceed) return;
                }
            }

            showToast(`æ­£åœ¨è§¦å‘ ${workflowId}...`, 'info');

            try {
                const response = await fetch(workflow.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        trigger_source: 'architecture_manager',
                        workflow_id: workflowId,
                        layer: workflow.layer,
                        subgroup: workflow.subgroup || null,
                        dependencies: workflow.dependencies,
                        input_table: workflow.inputTable || null,
                        output_table: workflow.outputTable || null,
                        timestamp: new Date().toISOString(),
                        user: 'Jason'
                    })
                });

                if (response.ok) {
                    const result = await response.text();
                    console.log(`${workflowId} è§¦å‘æˆåŠŸ:`, result);
                    showToast(`${workflowId} è§¦å‘æˆåŠŸï¼`, 'success');
                    workflow.lastRun = new Date().toLocaleString();
                    workflow.status = 'running';
                    saveWorkflows();
                    
                    if (workflow.layer === 2) {
                        renderLayer2WithSubgroups();
                    } else {
                        renderLayer(workflow.layer);
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showToast(`${workflowId} è§¦å‘å¤±è´¥: ${error.message}`, 'error');
                console.error('Webhookè§¦å‘å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•Webhook
        async function testWebhook(workflowId) {
            const workflow = workflows[workflowId];
            if (!workflow.webhookUrl) {
                showToast('è¯·å…ˆé…ç½®Webhook URL', 'error');
                return;
            }

            showToast(`æ­£åœ¨æµ‹è¯• ${workflowId}...`, 'info');

            try {
                const response = await fetch(workflow.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        test: true,
                        workflow_id: workflowId,
                        timestamp: new Date().toISOString(),
                        user: 'Jason'
                    })
                });

                if (response.ok) {
                    const result = await response.text();
                    console.log(`${workflowId} æµ‹è¯•æˆåŠŸ:`, result);
                    showToast(`${workflowId} æµ‹è¯•æˆåŠŸï¼`, 'success');
                } else {
                    showToast(`${workflowId} æµ‹è¯•å¤±è´¥: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showToast(`${workflowId} æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¿è¡Œæ•´ä¸ªå±‚çº§
        async function runLayer(layerNumber) {
            let layerWorkflows;
            
            if (layerNumber === 2) {
                layerWorkflows = Object.values(workflows).filter(wf => 
                    wf.layer === layerNumber && wf.webhookUrl
                );
            } else {
                layerWorkflows = Object.values(workflows).filter(wf => 
                    wf.layer === layerNumber && wf.webhookUrl && !wf.subgroup
                );
            }

            if (layerWorkflows.length === 0) {
                showToast(`ç¬¬${layerNumber}å±‚æ²¡æœ‰é…ç½®çš„å·¥ä½œæµ`, 'error');
                return;
            }

            if (!confirm(`ç¡®å®šè¦è¿è¡Œç¬¬${layerNumber}å±‚çš„æ‰€æœ‰å·¥ä½œæµå—ï¼Ÿ`)) return;

            showToast(`æ­£åœ¨è¿è¡Œç¬¬${layerNumber}å±‚ ${layerWorkflows.length} ä¸ªå·¥ä½œæµ...`, 'info');

            if (layerNumber === 2) {
                // ç¬¬äºŒå±‚ç‰¹æ®Šå¤„ç†ï¼šå…ˆè¿è¡ŒWF7å­ç»„ï¼Œå†è¿è¡ŒWF8
                const wf7Workflows = layerWorkflows.filter(wf => wf.subgroup === 'WF7');
                const wf8Workflows = layerWorkflows.filter(wf => wf.id === 'WF8');

                // å¹¶è¡Œè¿è¡ŒWF7å­ç»„
                if (wf7Workflows.length > 0) {
                    showToast('æ­£åœ¨å¹¶è¡Œè¿è¡ŒWF7å­å·¥ä½œæµç»„...', 'info');
                    const wf7Promises = wf7Workflows.map(wf => triggerWorkflow(wf.id));
                    await Promise.all(wf7Promises);
                    
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }

                // ä¸²è¡Œè¿è¡ŒWF8
                if (wf8Workflows.length > 0) {
                    showToast('æ­£åœ¨è¿è¡ŒWF8è¯æ®éªŒè¯æµ...', 'info');
                    for (const workflow of wf8Workflows) {
                        await triggerWorkflow(workflow.id);
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
            } else {
                // å…¶ä»–å±‚çº§æŒ‰åŸé€»è¾‘æ‰§è¡Œ
                if (layerNumber === 1 || layerNumber === 3) {
                    // å¹¶è¡Œæ‰§è¡Œ
                    const promises = layerWorkflows.map(wf => triggerWorkflow(wf.id));
                    await Promise.all(promises);
                } else {
                    // ä¸²è¡Œæ‰§è¡Œ
                    for (const workflow of layerWorkflows) {
                        await triggerWorkflow(workflow.id);
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }
            }

            showToast(`ç¬¬${layerNumber}å±‚æ‰§è¡Œå®Œæˆ`, 'success');
        }

        // è¿è¡ŒWF7å­å·¥ä½œæµç»„
        async function runWF7Subgroup() {
            const wf7Workflows = Object.values(workflows).filter(wf => 
                wf.subgroup === 'WF7' && wf.webhookUrl
            );

            if (wf7Workflows.length === 0) {
                showToast('WF7å­ç»„æ²¡æœ‰é…ç½®çš„å·¥ä½œæµ', 'error');
                return;
            }

            if (!confirm(`ç¡®å®šè¦å¹¶è¡Œè¿è¡ŒWF7çš„æ‰€æœ‰å­å·¥ä½œæµå—ï¼Ÿ`)) return;

            showToast(`æ­£åœ¨å¹¶è¡Œè¿è¡ŒWF7å­ç»„ ${wf7Workflows.length} ä¸ªå·¥ä½œæµ...`, 'info');

            const promises = wf7Workflows.map(wf => triggerWorkflow(wf.id));
            await Promise.all(promises);

            showToast('WF7å­å·¥ä½œæµç»„æ‰§è¡Œå®Œæˆ', 'success');
        }

        // æš‚åœæ•´ä¸ªå±‚çº§
        async function pauseLayer(layerNumber) {
            const layerWorkflows = Object.values(workflows).filter(wf => wf.layer === layerNumber);
            
            if (!confirm(`ç¡®å®šè¦æš‚åœç¬¬${layerNumber}å±‚çš„æ‰€æœ‰å·¥ä½œæµå—ï¼Ÿ`)) return;

            layerWorkflows.forEach(workflow => {
                workflow.status = 'paused';
            });

            saveWorkflows();
            if (layerNumber === 2) {
                renderLayer2WithSubgroups();
            } else {
                renderLayer(layerNumber);
            }
            showToast(`ç¬¬${layerNumber}å±‚å·²æš‚åœ`, 'info');
        }

        // æ£€æŸ¥å±‚çº§çŠ¶æ€
        function checkLayerStatus(layerNumber) {
            const layerWorkflows = Object.values(workflows).filter(wf => wf.layer === layerNumber);
            const configuredCount = layerWorkflows.filter(wf => wf.webhookUrl).length;
            const runningCount = layerWorkflows.filter(wf => wf.status === 'running').length;
            const completedCount = layerWorkflows.filter(wf => wf.status === 'completed').length;

            let statusMessage = `ç¬¬${layerNumber}å±‚çŠ¶æ€æŠ¥å‘Š:\n\n` +
                `ğŸ“Š æ€»å·¥ä½œæµ: ${layerWorkflows.length}\n` +
                `âœ… å·²é…ç½®: ${configuredCount}\n` +
                `ğŸ”„ è¿è¡Œä¸­: ${runningCount}\n` +
                `âœ”ï¸ å·²å®Œæˆ: ${completedCount}\n\n`;

            if (layerNumber === 2) {
                const wf7Count = layerWorkflows.filter(wf => wf.subgroup === 'WF7').length;
                const wf7Configured = layerWorkflows.filter(wf => wf.subgroup === 'WF7' && wf.webhookUrl).length;
                statusMessage += `ğŸ” WF7å­ç»„è¯¦æƒ…:\n` +
                    `   å­å·¥ä½œæµ: ${wf7Count}\n` +
                    `   å·²é…ç½®: ${wf7Configured}`;
            }

            alert(statusMessage);
        }

        // æ£€æŸ¥WF7çŠ¶æ€
        function checkWF7Status() {
            const wf7Workflows = Object.values(workflows).filter(wf => wf.subgroup === 'WF7');
            const configuredCount = wf7Workflows.filter(wf => wf.webhookUrl).length;
            const runningCount = wf7Workflows.filter(wf => wf.status === 'running').length;

            let statusMessage = `ğŸ” WF7å­ç»„çŠ¶æ€æŠ¥å‘Š:\n\n`;
            
            wf7Workflows.forEach(wf => {
                const status = wf.webhookUrl ? (wf.status === 'running' ? 'ğŸ”„ è¿è¡Œä¸­' : 'âœ… å·²é…ç½®') : 'âŒ æœªé…ç½®';
                statusMessage += `${wf.id}: ${status}\n`;
            });

            statusMessage += `\nğŸ“Š æ±‡æ€»: ${configuredCount}/${wf7Workflows.length} å·²é…ç½®`;

            alert(statusMessage);
        }

        // æŒ‰å±‚çº§é¡ºåºæ‰§è¡Œ
        async function runLayerSequentially() {
            if (!confirm('ç¡®å®šè¦æŒ‰ç…§æ¶æ„å±‚çº§é¡ºåºæ‰§è¡Œæ‰€æœ‰å·¥ä½œæµå—ï¼Ÿ\n\nè¿™å°†æŒ‰ç…§ä¾èµ–å…³ç³»ä¾æ¬¡æ‰§è¡Œå„å±‚çº§ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚')) return;

            showToast('ğŸš€ å¼€å§‹æŒ‰å±‚çº§é¡ºåºæ‰§è¡Œå®Œæ•´æ¶æ„...', 'info');

            try {
                // ç¬¬ä¸€å±‚ï¼šæ•°æ®é‡‡é›†å±‚ (å¹¶è¡Œ)
                showToast('ğŸ“¥ æ‰§è¡Œç¬¬1å±‚ï¼šæ•°æ®é‡‡é›†å±‚...', 'info');
                await runLayer(1);
                await waitForLayerCompletion(1, 300000); // ç­‰å¾…5åˆ†é’Ÿ

                // ç¬¬äºŒå±‚ï¼šä¿¡å·è¯†åˆ«å±‚ (WF7å¹¶è¡Œ + WF8ä¸²è¡Œ)
                showToast('ğŸ¯ æ‰§è¡Œç¬¬2å±‚ï¼šä¿¡å·è¯†åˆ«å±‚...', 'info');
                await runLayer(2);
                await waitForLayerCompletion(2, 600000); // ç­‰å¾…10åˆ†é’Ÿ

                // ç¬¬ä¸‰å±‚ï¼šæ·±åº¦åˆ†æå±‚ (å¹¶è¡Œ)
                showToast('ğŸ“Š æ‰§è¡Œç¬¬3å±‚ï¼šæ·±åº¦åˆ†æå±‚...', 'info');
                await runLayer(3);
                await waitForLayerCompletion(3, 480000); // ç­‰å¾…8åˆ†é’Ÿ

                // ç¬¬å››å±‚ï¼šå†³ç­–æ”¯æ’‘å±‚ (ä¸²è¡Œ)
                showToast('ğŸ¯ æ‰§è¡Œç¬¬4å±‚ï¼šå†³ç­–æ”¯æ’‘å±‚...', 'info');
                await runLayer(4);
                await waitForLayerCompletion(4, 240000); // ç­‰å¾…4åˆ†é’Ÿ

                showToast('ğŸ‰ æ‰€æœ‰å±‚çº§æ‰§è¡Œå®Œæˆï¼ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿå…¨æµç¨‹è¿è¡ŒæˆåŠŸï¼', 'success');
            } catch (error) {
                showToast(`âŒ æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // ç­‰å¾…å±‚çº§å®Œæˆ
        function waitForLayerCompletion(layerNumber, maxWaitTime) {
            return new Promise((resolve) => {
                showToast(`â³ ç­‰å¾…ç¬¬${layerNumber}å±‚å®Œæˆå¤„ç†...`, 'info');
                setTimeout(() => {
                    const layerWorkflows = Object.values(workflows).filter(wf => wf.layer === layerNumber);
                    layerWorkflows.forEach(wf => {
                        if (wf.status === 'running') {
                            wf.status = 'completed';
                        }
                    });
                    saveWorkflows();
                    if (layerNumber === 2) {
                        renderLayer2WithSubgroups();
                    } else {
                        renderLayer(layerNumber);
                    }
                    resolve();
                }, maxWaitTime);
            });
        }

        // å¯åŠ¨æ•°æ®é‡‡é›†å±‚
        async function runDataCollectionLayer() {
            await runLayer(1);
        }

        // æš‚åœæ‰€æœ‰å·¥ä½œæµ
        function pauseAllWorkflows() {
            if (!confirm('ç¡®å®šè¦æš‚åœæ‰€æœ‰å·¥ä½œæµå—ï¼Ÿ')) return;

            Object.values(workflows).forEach(workflow => {
                workflow.status = 'paused';
            });

            saveWorkflows();
            renderAllLayers();
            updateAllLayerStats();
            showToast('æ‰€æœ‰å·¥ä½œæµå·²æš‚åœ', 'info');
        }

        // åˆ·æ–°æ‰€æœ‰çŠ¶æ€
        function refreshAllStatus() {
            showToast('æ­£åœ¨åˆ·æ–°æ‰€æœ‰çŠ¶æ€...', 'info');
            
            Object.values(workflows).forEach(workflow => {
                if (workflow.webhookUrl && workflow.status === 'running') {
                    if (Math.random() > 0.7) {
                        workflow.status = 'completed';
                    }
                }
            });

            saveWorkflows();
            renderAllLayers();
            updateAllLayerStats();
            showToast('çŠ¶æ€åˆ·æ–°å®Œæˆ', 'success');
        }

        // å¯¼å‡ºæ‰€æœ‰é…ç½®
        function exportAllConfigs() {
            const exportData = {
                workflows: workflows,
                architecture: {
                    name: 'ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿ',
                    version: '2.1.0',
                    layers: [
                        { 
                            number: 1, 
                            name: 'æ•°æ®é‡‡é›†å±‚', 
                            execution: 'parallel', 
                            workflows: ['WF1', 'WF2', 'WF3', 'WF4', 'WF5', 'WF6'] 
                        },
                        { 
                            number: 2, 
                            name: 'ä¿¡å·è¯†åˆ«å±‚', 
                            execution: 'mixed', 
                            workflows: ['WF7-1', 'WF7-2', 'WF7-3', 'WF7-4', 'WF7-5', 'WF7-6', 'WF8'],
                            subgroups: {
                                'WF7': {
                                    name: 'æŠ€æœ¯ä¿¡å·è¯†åˆ«æµç»„',
                                    execution: 'parallel',
                                    workflows: ['WF7-1', 'WF7-2', 'WF7-3', 'WF7-4', 'WF7-5', 'WF7-6']
                                }
                            }
                        },
                        { 
                            number: 3, 
                            name: 'æ·±åº¦åˆ†æå±‚', 
                            execution: 'parallel', 
                            workflows: ['WF9', 'WF10', 'WF11'] 
                        },
                        { 
                            number: 4, 
                            name: 'å†³ç­–æ”¯æ’‘å±‚', 
                            execution: 'serial', 
                            workflows: ['WF12', 'WF13'] 
                        },
                        { 
                            number: 5, 
                            name: 'ç³»ç»Ÿç»´æŠ¤å±‚', 
                            execution: 'independent', 
                            workflows: ['WF14', 'WF15'] 
                        }
                    ]
                },
                exportTime: new Date().toISOString(),
                exportBy: 'Jason'
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `ict-architecture-config-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('å®Œæ•´æ¶æ„é…ç½®å·²å¯¼å‡º', 'success');
        }

        // æ‰¹é‡é…ç½®WF7å­ç»„
        function batchConfigureWF7() {
            const choice = confirm('WF7å­ç»„é…ç½®æ–¹å¼:\n\nç¡®å®š = ä½¿ç”¨ç»Ÿä¸€Routeræ–¹æ¡ˆï¼ˆæ¨èï¼‰\nå–æ¶ˆ = ä½¿ç”¨ç‹¬ç«‹Webhookæ–¹æ¡ˆ');
            
            if (choice) {
                // ç»Ÿä¸€Routeræ–¹æ¡ˆ
                const hubUrl = prompt('è¯·è¾“å…¥WF7ä¿¡å·è¯†åˆ«ä¸­å¿ƒçš„Webhook URL:\n\næ‰€æœ‰WF7å­å·¥ä½œæµå°†ä½¿ç”¨åŒä¸€ä¸ªURLï¼Œé€šè¿‡workflow_idåŒºåˆ†å¤„ç†é€»è¾‘ã€‚');
                if (!hubUrl) return;
                
                const wf7Workflows = Object.values(workflows).filter(wf => wf.subgroup === 'WF7');
                wf7Workflows.forEach(workflow => {
                    workflow.webhookUrl = hubUrl;
                    workflow.status = 'configured';
                });
                
                showToast('WF7å­ç»„å·²é…ç½®ä¸ºç»Ÿä¸€Routeræ¨¡å¼', 'success');
            } else {
                // ç‹¬ç«‹Webhookæ–¹æ¡ˆ
                const baseUrl = prompt('è¯·è¾“å…¥WF7å­ç»„çš„WebhookåŸºç¡€URL:\n\nç³»ç»Ÿå°†è‡ªåŠ¨ä¸ºæ¯ä¸ªå­å·¥ä½œæµç”Ÿæˆç‹¬ç«‹çš„URLã€‚');
                if (!baseUrl) return;
                
                const wf7Workflows = Object.values(workflows).filter(wf => wf.subgroup === 'WF7');
                wf7Workflows.forEach(workflow => {
                    workflow.webhookUrl = `${baseUrl}/${workflow.id.toLowerCase()}`;
                    workflow.status = 'configured';
                });
                
                showToast('WF7å­ç»„å·²é…ç½®ä¸ºç‹¬ç«‹Webhookæ¨¡å¼', 'success');
            }
            
            saveWorkflows();
            renderLayer2WithSubgroups();
            updateLayerStats(2);
        }

        // æ›´æ–°æ‰€æœ‰å±‚çº§ç»Ÿè®¡
        function updateAllLayerStats() {
            for (let layer = 1; layer <= 5; layer++) {
                updateLayerStats(layer);
            }
        }

        // æ›´æ–°å•ä¸ªå±‚çº§ç»Ÿè®¡
        function updateLayerStats(layerNumber) {
            const layerWorkflows = Object.values(workflows).filter(wf => wf.layer === layerNumber);
            const configuredCount = layerWorkflows.filter(wf => wf.webhookUrl).length;
            const totalCount = layerWorkflows.length;

            const statsElement = document.getElementById(`layer${layerNumber}-stats`);
            if (statsElement) {
                statsElement.textContent = `${configuredCount}/${totalCount} å·²é…ç½®`;
            }
        }

        // ä¿å­˜å·¥ä½œæµé…ç½®
        function saveWorkflows() {
            try {
                localStorage.setItem('workflows', JSON.stringify(workflows));
            } catch (error) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                showToast('ä¿å­˜é…ç½®å¤±è´¥', 'error');
            }
        }

                // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // Ctrl+1-5 å¿«é€Ÿè¿è¡Œå¯¹åº”å±‚çº§
            if (e.ctrlKey && e.key >= '1' && e.key <= '5') {
                e.preventDefault();
                const layer = parseInt(e.key);
                runLayer(layer);
            }
            
            // Ctrl+7 å¿«é€Ÿè¿è¡ŒWF7å­ç»„
            if (e.ctrlKey && e.key === '7') {
                e.preventDefault();
                runWF7Subgroup();
            }
            
            // Ctrl+A è¿è¡Œæ‰€æœ‰å±‚çº§
            if (e.ctrlKey && e.key === 'a') {
                e.preventDefault();
                runLayerSequentially();
            }
            
            // Ctrl+S ä¿å­˜é…ç½®
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveWorkflows();
                showToast('é…ç½®å·²ä¿å­˜', 'success');
            }
            
            // Ctrl+E å¯¼å‡ºé…ç½®
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportAllConfigs();
            }
            
            // Ctrl+R åˆ·æ–°çŠ¶æ€
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshAllStatus();
            }
        });

        // å®šæ—¶è‡ªåŠ¨ä¿å­˜
        setInterval(saveWorkflows, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜

        // é¡µé¢å¸è½½å‰ä¿å­˜
        window.addEventListener('beforeunload', function() {
            saveWorkflows();
        });

        // æ·»åŠ é¡µé¢å¯è§æ€§æ£€æµ‹ï¼Œå½“é¡µé¢é‡æ–°å¯è§æ—¶åˆ·æ–°çŠ¶æ€
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateAllLayerStats();
            }
        });

        // æ·»åŠ é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('é¡µé¢é”™è¯¯:', e.error);
            showToast('é¡µé¢è¿è¡Œå‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢', 'error');
        });

        // æ·»åŠ ç½‘ç»œçŠ¶æ€æ£€æµ‹
        window.addEventListener('online', function() {
            showToast('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
        });

        window.addEventListener('offline', function() {
            showToast('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨', 'error');
        });

        // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        setTimeout(() => {
            showToast('ğŸ¯ ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿæ¶æ„ç®¡ç†å™¨å·²åŠ è½½å®Œæˆï¼', 'success');
        }, 1000);

        // æ·»åŠ å¸®åŠ©åŠŸèƒ½
        function showHelp() {
            const helpMessage = `
ğŸ¯ ICTæŠ€æœ¯æƒ…æŠ¥ç³»ç»Ÿæ¶æ„ç®¡ç†å™¨ä½¿ç”¨æŒ‡å—

ğŸ“‹ å¿«æ·é”®ï¼š
â€¢ Ctrl+1-5: è¿è¡Œå¯¹åº”å±‚çº§
â€¢ Ctrl+7: è¿è¡ŒWF7å­ç»„
â€¢ Ctrl+A: æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰å±‚çº§
â€¢ Ctrl+S: ä¿å­˜é…ç½®
â€¢ Ctrl+E: å¯¼å‡ºé…ç½®
â€¢ Ctrl+R: åˆ·æ–°çŠ¶æ€

ğŸ”§ é…ç½®æ­¥éª¤ï¼š
1. åœ¨Make.comåˆ›å»ºWebhook
2. å¤åˆ¶URLåˆ°å·¥ä½œæµå¡ç‰‡
3. ç‚¹å‡»æµ‹è¯•éªŒè¯è¿æ¥
4. ç‚¹å‡»è¿è¡Œæ‰§è¡Œå·¥ä½œæµ

ğŸ“Š æ¶æ„è¯´æ˜ï¼š
â€¢ ç¬¬1å±‚ï¼šæ•°æ®é‡‡é›†ï¼ˆå¹¶è¡Œï¼‰
â€¢ ç¬¬2å±‚ï¼šä¿¡å·è¯†åˆ«ï¼ˆæ··åˆï¼‰
â€¢ ç¬¬3å±‚ï¼šæ·±åº¦åˆ†æï¼ˆå¹¶è¡Œï¼‰
â€¢ ç¬¬4å±‚ï¼šå†³ç­–æ”¯æ’‘ï¼ˆä¸²è¡Œï¼‰
â€¢ ç¬¬5å±‚ï¼šç³»ç»Ÿç»´æŠ¤ï¼ˆç‹¬ç«‹ï¼‰

ğŸ’¡ ç‰¹æ®ŠåŠŸèƒ½ï¼š
â€¢ WF7å­ç»„æ”¯æŒæ‰¹é‡é…ç½®
â€¢ æ”¯æŒä¾èµ–å…³ç³»æ£€æŸ¥
â€¢ è‡ªåŠ¨ä¿å­˜é…ç½®
â€¢ çŠ¶æ€å®æ—¶ç›‘æ§
            `;
            alert(helpMessage);
        }

        // æ·»åŠ å¸®åŠ©æŒ‰é’®åˆ°å…¨å±€æ§åˆ¶åŒº
        setTimeout(() => {
            const helpButton = document.createElement('button');
            helpButton.className = 'btn btn-info';
            helpButton.innerHTML = 'â“ å¸®åŠ©';
            helpButton.onclick = showHelp;
            
            const controlsDiv = document.querySelector('.global-controls');
            if (controlsDiv) {
                controlsDiv.appendChild(helpButton);
            }
        }, 500);
    </script>
</body>
</html>
